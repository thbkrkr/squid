<!doctype html>
<html>
<head>
<title>squid</title>
<link rel="icon" href="favicon.ico" type="image/gif">
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.1.8/semantic.min.css">
</head><body>
<style>
/** begin:CSS **/

.main, .tpl {
  padding-top: 1em;
}

.status-Up {
  background: rgba(139, 195, 74, 0.6);
}

.status-Exited {
  background: rgba(244, 67, 54, 0.6);
}

.status-Absent {
  background: rgba(118, 118, 118, 0.6);
}

.json {
  margin: 0;
  font-size: 0.8em;
  line-height: 1.2em;
}

.ui.inverted.dimmer {
  background-color: rgba(255, 255, 255, 0.4);
}

/** end:CSS **/
</style>
<!-- begin:HTML -->

<body>
<div class="ui main container">
  <div>
    <br>
    <button class="ui green basic button btn-refresh">refresh</a>
    <button class="ui teal basic button btn-up">up</a>
  </div>

  <div class="tpl deploy">
  </div>
  <div class="tpl status">
  </div>

  <script type="text/html" id="tpl_loading">
    <div class="ui active inverted dimmer">
      <div class="ui large text loader">Loading</div>
    </div>
  </script>

  <script type="text/html" id="tpl_status">
    <table class="ui padded very compact basic table">
      <!--
      <thead>
        <tr>
          <th>image</th>
          <th>status</th>
          <th>name</th>
          <th class="toggle-item-def" style="display:none">
          definition
          </th>
        </tr>
      </thead>
      -->
      <tbody>
        <% for ( var c in obj ) { %>
        <tr class="toggle-control-def status-<%= obj[c].status %>">
          <td><%= obj[c].image %></td>
          <td><%= obj[c].fullStatus %></td>
          <td><%= obj[c].name %></td>
          <td class="toggle-item-def" style="display:none">
            <pre class="toggle-item-def" style="display:none" class="json">
              <%= JSON.stringify(obj[c].definition, undefined, 2) %>
            </pre>
          </td>
        </tr>
        <% } %>
      </tbody>
  </script>

  <script type="text/html" id="tpl_deploy">
    <% for ( var cmd in obj ) { %>
    <div><%= obj[cmd].cmd.status %> - <%= obj[cmd].cmd.long_cmd %></div>
    <pre><% for ( var l in obj[cmd].result) { %><%= obj[cmd].result[l] + '\n'%><% } %></pre>
    <% } %>
  </script>

<!-- end:HTML -->
</div>
<script src="https://thbkrkr.github.io/s.js/dist/s.2.db65b41.js"></script><script>
/** begin:JS */

function show() {
  $get('/compose/status', function(data) {
    $('.tpl.status').html($tpl('tpl_status', data))

    $('.toggle-control-def').on('click', function() {
      $('.toggle-item-def').toggle()
    })
  })
}

function init() {
  $('.btn-refresh').on('click', function() {
    show()
  })

  $('.btn-up').on('click', function() {
    $('.tpl.deploy').html($tpl('tpl_loading'))

    $get('/compose/up', function(data) {
      $('.tpl.deploy').html($tpl('tpl_deploy', data))

      show()
    })
  })
}

function main() {
  init()
  show()
}

main()

/** end:JS */
</script></body></html>